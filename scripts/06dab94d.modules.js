angular.module("ng-firebase",[]).value("Firebase",Firebase),angular.module("ng-firebase").factory("firebaseCollection",["$timeout","Firebase",function(a,b){function c(a,b){this.$ref=a.ref(),this.$id=a.name(),this.$index=b,angular.extend(this,a.val())}return function(d){function e(a){return a?l[a]+1:0}function f(a,b){l[b.$id]=a,k.splice(a,0,b),console.log("added: ",a,b)}function g(a){var b=l[a];k.splice(b,1),l[a]=void 0,console.log("removed: ",a)}function h(a,b){k[a]=b,console.log("changed: ",a,b)}function i(a,b,c){k.splice(a,1),k.splice(b,0,c),j(a,b),console.log("moved: ",a," -> ",b,c)}function j(a,b){var c=k.length;for(b=b||c,b>c&&(b=c),index=a;b>index;index++){var d=k[index];d.$index=l[d.$id]=index}}var k=[],l={},m=new b(d);return m.on("child_added",function(b,d){a(function(){var a=e(d);f(a,new c(b,a)),j(a)})}),m.on("child_removed",function(b){a(function(){var a=b.name();g(a),j(l[a])})}),m.on("child_changed",function(b,d){a(function(){var a=l[b.name()],f=e(d),g=new c(b,a);h(a,g),f!==a&&i(a,f,g)})}),m.on("child_moved",function(b,c){a(function(){var a=l[b.name()],d=e(c),f=k[a];i(a,d,f)})}),k.$add=function(a){m.push(a)},k.$remove=function(a){var b=angular.isString(a)?k[a]:a;b.$ref.remove()},k.$update=function(a){var b=angular.isString(a)?k[a]:a,c={};angular.forEach(b,function(a,b){0!==b.indexOf("$")&&(c[b]=a)}),b.$ref.set(c)},k}}]),angular.module("ng-firebase").factory("firebaseBinding",["$timeout","$q","$parse","Firebase",function(a,b,c,d){return function(e,f,g){var h=c(g),i=h.assign;if(!i)throw new Error("expression "+g+"must be assignable");var j=new d(e),k=b.defer();return j.once("value",function(a){i(f,a.val()),k.resolve(h(f))}),j.on("value",function(b){a(function(){i(f,b.val())})}),f.$watch(h,function(a){j.set(a)},!0),k.promise}}]).factory("firebaseBindingSimple",["$timeout","$parse","Firebase",function(a,b,c){return function(d,e,f){var g=b(f),h=g.assign;if(!h)throw new Error("expression "+f+"must be assignable");var i=new c(d);i.on("value",function(b){a(function(){h(e,b.val())})}),e.$watch(g,function(a){i.set(a)},!0)}}]);