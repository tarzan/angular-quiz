!function(){angular.module("quizApp",["ng-firebase","ng-firebase-simple-login"]).config(["$routeProvider",function(a){var b;return b=function(a){return a.requestCurrentUser()},b.$inject=["AuthService"],a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{currentUser:b}}).when("/login",{templateUrl:"views/login.html",controller:"LogInCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignUpCtrl"}).otherwise({redirectTo:"/"})}]).constant("FIREBASE_URL","https://quiz-test.firebaseIO.com/")}.call(this),function(){angular.module("ng-firebase-simple-login",["ng-firebase"]).value("FirebaseSimpleLogin",FirebaseSimpleLogin)}.call(this),function(){angular.module("quizApp").factory("safeApply",["$rootScope",function(a){var b;return b=function(b){var c;return c=a.$$phase,"$apply"===c||"$digest"===c?b():a.$apply(b)}}]).factory("AuthService",["$q","$log","DBConnection","FirebaseSimpleLogin","safeApply",function(a,b,c,d,e){var f,g,h,i,j;return h=null,i=a.defer(),g=function(a,c){return a?(b.error("auth: Error: "+a),e(function(){return i?i.reject(a):void 0})):c?(b.log("auth: User logged in! User Id: "+c.id+", Email: "+c.email),h=c,e(function(){return null!=i?i.resolve(c):void 0})):(b.log("auth: User not authenticated!!!"),h=null,i?i.reject({reason:"ACCESS_DENIED"}):void 0)},f=new d(c,g),j={login:function(c,d){return b.log("auth: login ->",c),j.logout(),i=a.defer(),f.login("password",{email:c,password:d}),i.promise},logout:function(){return i&&i.reject("logging out"),f.logout()},signup:function(c,d){var g;return b.log("auth: signup -> "+c),j.logout(),g=a.defer(),f.createUser(c,d,function(a,b){return e(function(){return a?g.reject(a):g.resolve(b)})}),g.promise},requestCurrentUser:function(){var c;return b.log("auth: requesting current user"),null!=h?a.when(h):null!=i?i.promise:(c=a.defer(),c.reject({reason:"ACCESS_DENIED"}),c.promise)}}}]).factory("LoginValidator",function(){var a;return a={validate:function(a,b){var c;return c=!0,a.email||(b("Invalid email"),c=!1),a.password||(b("Invalid password"),c=!1),c}}})}.call(this),function(){angular.module("quizApp").factory("Flash",["$rootScope",function(a){var b,c,d,e;return d=a.flash={},c={},a.$on("$routeChangeSuccess",function(){var a,b,e,f,g;for(f=["errors","successes"],g=[],b=0,e=f.length;e>b;b++)a=f[b],d[a]=c[a],g.push(c[a]=[]);return g}),b=function(a){var b;return b={reset:function(){return a.errors=[],a.successes=[],b},error:function(b){return a.errors.push(b)},success:function(b){return a.successes.push(b)}},b.reset()},e={now:b(d),future:b(c)}}])}.call(this),function(){angular.module("quizApp").factory("DBConnection",["Firebase","FIREBASE_URL",function(a,b){return new a(b)}]).factory("DB",["DBConnection","safeApply","$q","$log",function(a,b,c,d){var e,f;return e=a,f={read:function(a){var f;return f=c.defer(),e.child(a).on("value",function(c){var e;return e=c.val(),d.log("db: loaded "+a+" "+e),b(function(){return f.resolve(e)})}),f.promise},write:function(a,d){var f,g;return f=c.defer(),g=e.child(a),g.set(d,function(a){return b(function(){return a?f.reject(a):f.resolve(!0)})}),f.promise}}}])}.call(this),function(){angular.module("quizApp").factory("Quiz",["DB","$q",function(a,b){var c,d,e;return c=null,e={},d={loadQuestions:function(){return a.read("questions")},loadAnswers:function(){return c?b.when(c):a.read("answers").then(function(a){return c=a})},loadResponse:function(c){return e[c]?b.when(e[c]):a.read("responses/"+c).then(function(a){return e[c]=a})},submitResponse:function(b,c){return a.write("responses/"+b,c)}}}])}.call(this),function(){angular.module("quizApp").controller("AppCtrl",["$scope","$location","$log","AuthService",function(a,b,c,d){return a.$on("$routeChangeError",function(a,d,e,f){return c.log("$routeChangeError",arguments),"ACCESS_DENIED"===f.reason?b.path("/login"):void 0}),a.logout=function(){return d.logout(),b.path("/login")}}])}.call(this),function(){angular.module("quizApp").controller("MainCtrl",["$scope","currentUser","Quiz","$log","$q",function(a,b,c,d,e){var f;return a.disabled=!1,a.questions=!1,a.status="Loading questions. Please wait...",f=[],f.push(c.loadQuestions().then(function(b){return a.questions=b})),f.push(c.loadResponse(b.id).then(function(b){return a.response=b,a.disabled=null!==b})),e.all(f).then(function(){var b,c,d,e,f,g,h,i,j,k;if(e=a.response)for(j=a.questions,f=0,h=j.length;h>f;f++)if(c=j[f],d=e[c.name])for(k=c.options,g=0,i=k.length;i>g;g++)b=k[g],b.checked=d[b.value];return null}).then(function(){return a.status=null}),a.showCorrectAnswers=function(){return c.loadAnswers().then(function(b){var c,d,e,f,g,h,i,j,k;for(j=a.questions,f=0,h=j.length;h>f;f++)if(e=j[f],c=b[e.name])for(k=e.options,g=0,i=k.length;i>g;g++)d=k[g],d.correct=c[d.value],d.checked&&!d.correct&&(d.invalid=!0),!!d.checked!==d.correct&&(e.invalid=!0);return a})},a.submitResponse=function(){var e,f,g,h,i,j,k,l,m;for(a.processing=!0,g={},l=a.questions,h=0,j=l.length;j>h;h++)for(f=l[h],g[f.name]={},m=f.options,i=0,k=m.length;k>i;i++)e=m[i],g[f.name][e.value]=e.checked||!1;return c.submitResponse(b.id,g).then(function(){return a.success="Thanks for submitting the response!",a.response=g,a.disabled=!0},function(b){return a.error="Failed to save the response: "+b,d.error(b)}),a}}])}.call(this),function(){angular.module("quizApp").controller("SignUpCtrl",["$scope","$location","AuthService","Flash","LoginValidator",function(a,b,c,d,e){var f;return f=function(a){return d.now.error(a)},a.signup=function(){var g,h;return e.validate(a,f)?(a.processing=!0,h=function(){return d.future.success("You've been signed up! Now you can log in."),b.path("/login")},g=function(b){return d.now.error(b.message||b),a.processing=!1},c.signup(a.email,a.password).then(h,g)):void 0}}])}.call(this),function(){angular.module("quizApp").controller("LogInCtrl",["$scope","$location","AuthService","Flash","LoginValidator",function(a,b,c,d,e){var f;return f=function(a){return d.now.error(a)},a.login=function(){var g,h;return d.now.reset(),e.validate(a,f)?(a.processing=!0,h=function(){return d.future.success("Welcome!"),b.path("/")},g=function(b){return d.now.error(b.message||b),a.processing=!1},c.login(a.email,a.password).then(h,g)):void 0}}])}.call(this);